<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>í€´ì¦ˆ í’€ê¸°</title>
<style>
body { font-family: 'Noto Sans KR'; padding: 20px; }
button {
  display: block; width: 100%; margin: 10px 0;
  padding: 12px; font-size: 18px; border-radius: 10px;
  border: 1px solid #aaa; background: #fff;
}
.correct { background: #b9f6ca !important; }
.wrong { background: #ffccbc !important; }
#next { background:#90caf9; margin-top: 15px; }
</style>
</head>
<body>

<h2>ğŸ§  ëœë¤ ê¸°ì¶œ í€´ì¦ˆ</h2>
<div id="quiz"></div>
<button id="next" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
<button onclick="location.href='index.html'">ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>

<script>
let saved = JSON.parse(localStorage.getItem("quizData") || "[]");
let wrongList = JSON.parse(localStorage.getItem("wrongList") || "[]");

// ì˜¤ë‹µ ìˆìœ¼ë©´ ì˜¤ë‹µ ë¨¼ì € í’€ê¸°
let qData = wrongList.length > 0 ? wrongList : saved;

if(qData.length === 0){
  document.body.innerHTML = "<h2>ë¬¸ì œë¥¼ ë¨¼ì € ì¶”ê°€í•˜ì„¸ìš”!</h2>";
  throw new Error("No questions");
}

function shuffle(arr){
  let a=[...arr];
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

let order = shuffle([...Array(qData.length).keys()]);
let current = 0;

function loadQuestion(){
  const q = qData[order[current]];
  window.currentQuestion = q;

  let html = `<h3>${q.q}</h3>`;
  let shuffled = shuffle(q.choices);
  
  shuffled.forEach(c=>{
    html += `<button class='choice'>${c}</button>`;
  });

  document.getElementById("quiz").innerHTML = html;

  document.querySelectorAll(".choice").forEach(btn=>{
    btn.onclick = () => check(btn, q.answer);
  });
}

function check(btn, answer){
  let q = window.currentQuestion;
  document.querySelectorAll(".choice").forEach(b=>b.disabled=true);

  if(btn.innerText === answer){
    btn.classList.add("correct");

    // ë§Œì•½ ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ì— ìˆì—ˆìœ¼ë©´ ì œê±°
    wrongList = wrongList.filter(x => x.q !== q.q);
    localStorage.setItem("wrongList", JSON.stringify(wrongList));
    
  } else {
    btn.classList.add("wrong");

    // ì˜¤ë‹µ ì €ì¥ (ì¤‘ë³µ ë°©ì§€)
    if(!wrongList.some(x => x.q === q.q)){
      wrongList.push(q);
      localStorage.setItem("wrongList", JSON.stringify(wrongList));
    }

    document.querySelectorAll(".choice").forEach(b=>{
      if(b.innerText === answer) b.classList.add("correct");
    });
  }
}

function nextQuestion(){
  current++;
  if(current >= qData.length){
    // ì˜¤ë‹µ í’€ì—ˆìœ¼ë©´ ìë™ ì „ì²´ ë¬¸ì œëª¨ë“œë¡œ
    wrongList = JSON.parse(localStorage.getItem("wrongList") || "[]");
    location.reload();  
    return;
  }
  loadQuestion();
}

loadQuestion();
</script>

</body>
</html>
