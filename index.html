<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ëœë¤ ê¸°ì¶œ ì•±</title>
<link rel="manifest" href="manifest.json" />
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
<style>
body { font-family: 'Noto Sans KR', Arial; max-width: 640px; margin: 0 auto; padding: 20px; }
nav { display: flex; gap: 8px; margin-bottom: 16px; }
nav button { flex: 1; padding: 12px; font-size: 16px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
.section { display: none; }
.section.active { display: block; }
.btn { display:block; width:100%; padding:12px; margin:10px 0; font-size:18px; border-radius:10px; border:1px solid #aaa; background:#fff; cursor:pointer; }
.correct { background:#b9f6ca !important; }
.wrong   { background:#ffccbc !important; }
#next { background:#90caf9; }
input, textarea { width:100%; padding:10px; margin:8px 0; font-size:16px; box-sizing:border-box; }
small { color:#666; }
hr { border:0; border-top:1px solid #eee; margin:16px 0; }
</style>
</head>
<body>

<h2>ğŸ“š ëœë¤ ê¸°ì¶œ ì•±</h2>

<nav>
  <button id="tab-quiz">ë¬¸ì œ í’€ê¸°</button>
  <button id="tab-add">ë¬¸ì œ ì¶”ê°€</button>
  <button id="tab-more">ì„¤ì •</button>
</nav>

<!-- ë¬¸ì œ í’€ê¸° -->
<section id="view-quiz" class="section active">
  <div id="quiz-box"></div>
  <button id="next" class="btn">ë‹¤ìŒ ë¬¸ì œ</button>
  <div id="mode-info"></div>
</section>

<!-- ë¬¸ì œ ì¶”ê°€ -->
<section id="view-add" class="section">
  <h3>âœï¸ ë¬¸ì œ ì¶”ê°€</h3>
  <label>ë¬¸ì œ</label>
  <textarea id="q-text" placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>

  <label>ë³´ê¸°ë¥¼ ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„</label>
  <input id="q-choices" placeholder="ì˜ˆ: ë‹´ì„,ê°„ì—¼,ë‹´ë‚­ í´ë¦½,ì·Œì¥ì—¼" />

  <label>ì •ë‹µ</label>
  <input id="q-answer" placeholder="ì˜ˆ: ë‹´ì„" />

  <button id="btn-save" class="btn">ì €ì¥í•˜ê¸°</button>
  <small id="save-msg"></small>

  <hr />
  <button id="btn-export" class="btn">ëª¨ë“  ë¬¸ì œ ë‚´ë³´ë‚´ê¸°(JSON)</button>
  <button id="btn-import" class="btn">ë¬¸ì œ ê°€ì ¸ì˜¤ê¸°(JSON ë¶™ì—¬ë„£ê¸°)</button>
</section>

<!-- ì„¤ì •/ë„êµ¬ -->
<section id="view-more" class="section">
  <h3>âš™ï¸ ì„¤ì •</h3>
  <button id="btn-clear-wrong" class="btn">ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”</button>
  <button id="btn-clear-all" class="btn">ëª¨ë“  ë¬¸ì œ ì‚­ì œ(ì£¼ì˜)</button>
  <small>ë¬¸ì œ/ì˜¤ë‹µì€ ì´ ê¸°ê¸°ì˜ ì €ì¥ê³µê°„(LocalStorage)ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</small>
</section>

<script>
// ===== ê³µí†µ ì €ì¥ =====
const load = (k, d) => JSON.parse(localStorage.getItem(k) || d);
const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

// ===== íƒ­ ì „í™˜ =====
const show = id => {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
};
document.getElementById('tab-quiz').onclick = () => show('view-quiz');
document.getElementById('tab-add').onclick  = () => show('view-add');
document.getElementById('tab-more').onclick = () => show('view-more');

// ===== ë¬¸ì œ ë°ì´í„° =====
let all = load('quizData', '[]') || [];
let wrong = load('wrongList', '[]') || [];

// ì´ˆê¸° ìƒíƒœ: ì˜¤ë‹µì´ ìˆìœ¼ë©´ ì˜¤ë‹µë¶€í„°, ì—†ìœ¼ë©´ ì „ì²´
let pool = (wrong.length > 0 ? wrong : all).slice();
let mode = (wrong.length > 0 ? 'ì˜¤ë‹µ ìš°ì„  ëª¨ë“œ' : 'ì „ì²´ ëœë¤ ëª¨ë“œ');

function shuffle(a){
  let arr = a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

let order = shuffle([...Array(pool.length).keys()]);
let cur = 0;
let currentQ = null;

function ensurePool(){
  all = load('quizData','[]') || [];
  wrong = load('wrongList','[]') || [];
  pool = (wrong.length > 0 ? wrong : all).slice();
  mode = (wrong.length > 0 ? 'ì˜¤ë‹µ ìš°ì„  ëª¨ë“œ' : 'ì „ì²´ ëœë¤ ëª¨ë“œ');
  order = shuffle([...Array(pool.length).keys()]);
  cur = 0;
}

function renderMode(){
  const el = document.getElementById('mode-info');
  el.innerHTML = `<small>í˜„ì¬: ${mode} (ë¬¸í•­ ${pool.length}ê°œ)</small>`;
}

function loadQuestion(){
  if(pool.length === 0){
    document.getElementById('quiz-box').innerHTML =
      `<h3>ì•„ì§ ë¬¸ì œê°€ ì—†ì–´ìš” ğŸ¥º</h3><p>ìƒë‹¨ì˜ <b>ë¬¸ì œ ì¶”ê°€</b> íƒ­ì—ì„œ ë¬¸ì œë¥¼ ë„£ì–´ì£¼ì„¸ìš”.</p>`;
    renderMode();
    return;
  }
  const q = pool[order[cur]];
  currentQ = q;

  let html = `<h3>${q.q}</h3>`;
  const shuf = shuffle(q.choices || []);
  shuf.forEach(c => {
    html += `<button class="btn choice">${c}</button>`;
  });

  document.getElementById('quiz-box').innerHTML = html;

  document.querySelectorAll('.choice').forEach(btn => {
    btn.onclick = () => check(btn, q.answer);
  });

  renderMode();
}

function check(btn, answer){
  document.querySelectorAll('.choice').forEach(b => b.disabled = true);

  if(btn.innerText === answer){
    btn.classList.add('correct');
    // ì˜¤ë‹µ ë¦¬ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ ì œê±°
    wrong = load('wrongList','[]') || [];
    wrong = wrong.filter(x => x.q !== currentQ.q);
    save('wrongList', wrong);
  } else {
    btn.classList.add('wrong');
    document.querySelectorAll('.choice').forEach(b => {
      if(b.innerText === answer) b.classList.add('correct');
    });
    // ì˜¤ë‹µ ì €ì¥(ì¤‘ë³µ ë°©ì§€)
    wrong = load('wrongList','[]') || [];
    if(!wrong.some(x => x.q === currentQ.q)){
      wrong.push(currentQ);
      save('wrongList', wrong);
    }
  }
}

document.getElementById('next').onclick = () => {
  if(pool.length === 0){ return; }
  cur++;
  if(cur >= pool.length){
    // ì„¸ì…˜ ë â†’ ìµœì‹  ì˜¤ë‹µ/ì „ì²´ ìƒíƒœë¡œ ê°±ì‹ 
    ensurePool();
  }
  loadQuestion();
};

// ===== ë¬¸ì œ ì¶”ê°€ =====
document.getElementById('btn-save').onclick = () => {
  const q = document.getElementById('q-text').value.trim();
  const cs = document.getElementById('q-choices').value.split(',').map(s => s.trim()).filter(Boolean);
  const a = document.getElementById('q-answer').value.trim();

  if(!q || cs.length < 2 || !a){
    alert('ë¬¸ì œ/ë³´ê¸°/ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”!');
    return;
  }
  if(!cs.includes(a)){
    alert('ì •ë‹µì€ ë³´ê¸° ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }

  all = load('quizData','[]') || [];
  all.push({ q, choices: cs, answer: a });
  save('quizData', all);

  document.getElementById('q-text').value = '';
  document.getElementById('q-choices').value = '';
  document.getElementById('q-answer').value = '';
  document.getElementById('save-msg').innerText = 'âœ… ì €ì¥ ì™„ë£Œ! ìƒë‹¨ íƒ­ì—ì„œ ë°”ë¡œ í’€ ìˆ˜ ìˆì–´ìš”.';

  // ìƒˆ ë¬¸ì œ ë°˜ì˜
  ensurePool();
};

// ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°
document.getElementById('btn-export').onclick = () => {
  const data = JSON.stringify(load('quizData','[]') || [], null, 2);
  prompt('ì•„ë˜ JSONì„ ë³µì‚¬í•˜ì„¸ìš”', data);
};
document.getElementById('btn-import').onclick = () => {
  const text = prompt('ë¶™ì—¬ë„£ì„ JSONì„ ì…ë ¥í•˜ì„¸ìš”');
  if(!text) return;
  try {
    const arr = JSON.parse(text);
    if(!Array.isArray(arr)) throw new Error();
    save('quizData', arr);
    ensurePool();
    alert('âœ… ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!');
  } catch(e){
    alert('JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
};

// ìµœì´ˆ ì§„ì…
ensurePool();
loadQuestion();
</script>
</body>
</html>

